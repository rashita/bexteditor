# 2025-07-06 作業記録

## 概要

本日は、ファイルメニューの機能拡張と、複数ウィンドウ利用時の不具合修正に加え、エディタのコア部分の大規模なリファクタリングを行いました。

## 詳細

1.  **新規作成機能の追加**
    *   ファイルメニューに「New」項目を追加しました。
    *   ショートカット `CmdOrCtrl+N` で新しいウィンドウを開くことができます。

2.  **保存機能の不具合修正**
    *   ウィンドウが一つも開かれていない状態で「Save」メニューをクリックすると発生していたクラッシュを修正しました。
    *   複数のウィンドウが開かれている場合に、フォーカスされているウィンドウのファイルのみが正しく保存されるように修正しました。

3.  **ファイルオープン機能の不具合修正**
    *   複数のウィンドウが開かれている場合に、フォーカスされているウィンドウでファイルが開かれるように修正しました。

4.  **エディタのコアアーキテクチャのリファクタリング**
    *   **問題点:** 従来の`contenteditable`な単一`div`では、漢字変換直後の改行が二度Enterキーを押さないと入力されない問題が発生していました。
    *   **解決策:** 将来的な拡張性（行単位での装飾など）も見据え、エディタの構造をObsidianのように一行を一つの`div`で管理する方式に抜本的に変更しました。
    *   **実装内容:**
        *   `index.html`を修正し、各行を表示するための`.line`クラスのスタイルを追加しました。
        *   `renderer.js`を全面的に書き換え、ファイル読み込み時に各行を`div`で生成し、保存時には各`div`の内容を結合して保存するロジックを実装しました。
        *   `Enter`キーで行が分割され、新しい`div`が生成されるように`handleNewLine`関数を再実装しました。
        *   行頭で`Backspace`キーを押した際に、前の行と結合されるように`handleBackspace`関数を追加しました。
        *   テキストノードと要素ノードの違いから生じるエラーを修正し、安定した動作を実現しました。

## 主な変更ファイル

*   `main.js`
*   `index.html`
*   `renderer.js`
